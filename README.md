# Database_lab_1

1. Дана схема базы данных в виде следующих отношений. С помощью операторов SQL создать логическую структуру соответствующих таблиц для хранения в СУБД, используя известные средства поддержания целостности (NOT NULL, UNIQUE, и т.д.). Обосновать выбор типов данных и используемые средства поддержания целостности. При выборе подходящих типов данных использовать информацию о конкретных значениях полей БД.

2. Ввести в ранее созданные таблицы конкретные данные (см. прил. 1). Использовать скрипт-файл из операторов INSERT или вспомогательную утилиту.
```sql
insert into "ЗАКАЗЧИК"("ИДЕНТИФИКАТОР", "ФАМИЛИЯ", "РАЙОН", "СКИДКА, %")
 values (001, 'Жалнин' ,'Приокский', 2),
        (002, 'Семенов' ,'Советский', 6),
        (003, 'Кожаков' ,'Ленинский', 0),
        (004, 'Шерстнев' ,'Автозаводский', 0),
        (005, 'Козлов' ,'Нижегородский', 4);

insert into "ПУНКТ ПРОКАТА"("ИДЕНТИФИКАТОР", "НОМЕР", "РАСПОЛОЖЕНИЕ", "КОМИССИОННЫЕ, %")
 values (001, 'N23', 'Нижегородский', 4),
        (002, 'N16', 'Советский', 5),
        (003, 'N8', 'Сормовский', 7),
        (004, 'N21', 'Приокский', 3),
        (005, 'N12', 'Нижегородский', 2),
        (006, 'N6', 'Канавинский', 5);

insert into "ВЕЩИ"("ИДЕНТИФИКАТОР", "НАЗВАНИЕ", "СКЛАД", "КОЛ-ВО", "ПРОКАТНАЯ ЦЕНА ЗА НЕДЕЛЮ, РУБ")
 values (001, 'Телевизор', 'Нижегородский', 7, 10000),
        (002, 'Часы напольные', 'Советский', 6, 5000),
        (003, 'Радиоприемник', 'Нижегородский', 10, 7000),
        (004, 'Часы настенные', 'Приокский', 20, 3000),
        (005, 'Холодильник', 'Сормовский', 6, 12000),
        (006, 'Утюг', 'Нижегородский', 30, 2000),
        (007, 'Весы детские', 'Нижегородский', 15, 1500);

insert into "ПРОКАТ"("НОМЕР", "КЛИЕНТ", "ДАТА", "ПУНКТ ПРОКАТА", "ВЕЩЬ", "СРОК ПРОКАТА", "СУММА, РУБ")
 values (10005, 002, 'Январь', 003, 003, 4, 28000),
        (10006, 003, 'Январь', 003, 007, 1, 1500),
        (10007, 004, 'Январь', 002, 006, 8, 16000),
        (10008, 003, 'Февраль', 002, 005, 4, 48000),
        (10009, 004, 'Февраль', 001, 001, 4, 40000),
        (10010, 005, 'Март', 003, 006, 4, 8000),
        (10011, 005, 'Март', 006, 003, 8, 56000),
        (10012, 001, 'Апрель', 003, 003, 8, 56000),
        (10013, 004, 'Апрель', 004, 002, 2, 10000),
        (10014, 002, 'Май', 005, 007, 2, 3000),
        (10015, 004, 'Май', 006, 004, 1, 3000),
        (10016, 004, 'Май', 002, 001, 11, 110000),
        (10017, 003, 'Июнь', 001, 001, 1, 10000),
        (10018, 005, 'Июль', 001, 007, 1, 1500),
        (10019, 003, 'Август', 003, 002, 4, 20000),
        (10020, 004, 'Август', 005, 002, 4, 20000),
        (10021, 001, 'Август', 003, 001, 2, 20000);
	
	[2021-04-11 21:54:32] 5 rows affected in 28 ms
	[2021-04-11 21:56:50] 6 rows affected in 23 ms
	[2021-04-11 22:05:58] 7 rows affected in 14 ms
	[2021-04-11 22:05:58] 17 rows affected in 12 ms
```


3. Используя оператор SELECT создать запрос для вывода всех строк каждой таблицы. Проверить правильность ввода. При необходимости произвести коррекцию значений операторами INSERT, UPDATE, DELETE.

```sql
select*
from "ЗАКАЗЧИК";
```

| ИДЕНТИФИКАТОР | ФАМИЛИЯ | РАЙОН | СКИДКА, % |
| :--- | :--- | :--- | :--- |
| 1 | Жалнин | Приокский | 2 |
| 2 | Семенов | Советский | 6 |
| 3 | Кожаков | Ленинский | 0 |
| 4 | Шерстнев | Автозаводский | 0 |
| 5 | Козлов | Нижегородский | 4 |


```sql
select*
from "ПУНКТ ПРОКАТА";
```

| ИДЕНТИФИКАТОР | НОМЕР | РАСПОЛОЖЕНИЕ | КОМИССИОННЫЕ, % |
| :--- | :--- | :--- | :--- |
| 1 | N23 | Нижегородский | 4 |
| 2 | N16 | Советский | 5 |
| 3 | N8 | Сормовский | 7 |
| 4 | N21 | Приокский | 3 |
| 5 | N12 | Нижегородский | 2 |
| 6 | N6 | Канавинский | 5 |


```sql
select*
from "ВЕЩИ";
```

| ИДЕНТИФИКАТОР | НАЗВАНИЕ | СКЛАД | КОЛ-ВО | ПРОКАТНАЯ ЦЕНА ЗА НЕДЕЛЮ, РУБ |
| :--- | :--- | :--- | :--- | :--- |
| 1 | Телевизор | Нижегородский | 7 | 10000 |
| 2 | Часы напольные | Советский | 6 | 5000 |
| 3 | Радиоприемник | Нижегородский | 10 | 7000 |
| 4 | Часы настенные | Приокский | 20 | 3000 |
| 5 | Холодильник | Сормовский | 6 | 12000 |
| 6 | Утюг | Нижегородский | 30 | 2000 |
| 7 | Весы детские | Нижегородский | 15 | 1500 |


```sql
select*
from "ПРОКАТ";
```

| НОМЕР | КЛИЕНТ | ДАТА | ПУНКТ ПРОКАТА | ВЕЩЬ | СРОК ПРОКАТА | СУММА, РУБ |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 10005 | 2 | Январь | 3 | 3 | 4 | 28000 |
| 10006 | 3 | Январь | 3 | 7 | 1 | 1500 |
| 10007 | 4 | Январь | 2 | 6 | 8 | 16000 |
| 10008 | 3 | Февраль | 2 | 5 | 4 | 48000 |
| 10009 | 4 | Февраль | 1 | 1 | 4 | 40000 |
| 10010 | 5 | Март | 3 | 6 | 4 | 8000 |
| 10011 | 5 | Март | 6 | 3 | 8 | 56000 |
| 10012 | 1 | Апрель | 3 | 3 | 8 | 56000 |
| 10013 | 4 | Апрель | 4 | 2 | 2 | 10000 |
| 10014 | 2 | Май | 5 | 7 | 2 | 3000 |
| 10015 | 4 | Май | 6 | 4 | 1 | 3000 |
| 10016 | 4 | Май | 2 | 1 | 11 | 110000 |
| 10017 | 3 | Июнь | 1 | 1 | 1 | 10000 |
| 10018 | 5 | Июль | 1 | 7 | 1 | 1500 |
| 10019 | 3 | Август | 3 | 2 | 4 | 20000 |
| 10020 | 4 | Август | 5 | 2 | 4 | 20000 |
| 10021 | 1 | Август | 3 | 1 | 2 | 20000 |



4. Создать запросы для вывода:
	•	всех различных фамилий заказчиков и размеров их скидок;
	•	всех различных районов проживания заказчиков;
	•	всех названий прокатных пунктов и их мест расположения.


5. Создав запрос получить следующую информацию:
	•	идентификаторы и фамилии заказчиков, проживающих в Приокском или Сормовском районе или тех, чьи фамилии оканчиваются на “ин”;
	•	номер, дата, срок проката и сумма для тех записей, где сумма проката более 2000руб. Отсортировать по возрастанию суммы и срока проката;
	•	названия вещей и адрес складирования, для вещей, оставшихся в количестве не менее 7.
  
  
6. На основании данных о прокате вещей вывести все данные в таком формате:
	•	фамилия клиента, название пункта проката, дата, номер прокатной квитанции. Отсортировать по первым двум полям;
	•	название пункта проката, дата, название вещи, сумма.


7. Вывести:
	•	названия прокатных пунктов, которые отдавали в прокат утюги или оказывали услуги клиентам своего района;
	•	имена и адреса заказчиков, бравших в прокат вещи со стоимостью проката более 8000руб не ранее февраля месяца. Вывести вместе с названиями прокатных пунктов, где были взяты вещи, проиведя по ним сортировку;
	•	 название и прокатную цену вещей взятых заказчиком Кожаковым в прокатных пунктах других районов;
	•	 название и оставшееся количество вещей, которые отдавали более чем в одном прокатном пункте.


8. Создать запрос для модификации всех значений столбца с суммарной величиной оплаты таблицы прокат, чтобы он содержал истинную сумму, оплачиваемую клиентом ( с учетом скидки). Вывести новые значения.


9. Расширить таблицу с данными о прокате столбцом, содержащим величину взимаемых комиссионых. Создать запрос для ввода конкретных значений во все строки таблицы проката.


# Уровень 2

1. Используя операцию IN (NOT IN)  реализовать следующие запросы:
	•	найти вещи, бравшиеся в прокат заказчиками с размером скидки более 2%;
	•	найти все вещи, бравшиеся в прокат заказчиком, бравшим что-либо в прокатных пунктах своего района;
  •	запросы заданий 7.b, 7.с.
  
  
2. Используя операции ALL-ANY реализовать следующие запросы:
	•	определить те вещи, которые брались летом на самый продолжительный срок;
	•	найти прокатные пункты, отдававшие вещи с самой большой ценой;
	•	найти таких заказчиков, которые имеют такой же размер скидки, как кто-либо из бравших на прокат радиоприемник;
	•	запрос задания 7.а.
  
  
3. Используя операцию UNION получить адреса проживания заказчиков и места расположения прокатных пунктов.


4. Используя операцию EXISTS ( NOT EXISTS ) реализовать нижеследующие запросы. В случае, если для текущего состояния БД запрос будет выдавать пустое множество строк, требуется указать какие добавления в БД необходимо провести.
	•	найти две самые дорогие вещи, сдававшиеся в прокат не позднее октября;
	•	найти прокатные пункты, сдававшие все вещи всем заказчикам из Нижегородского района;
	•	найти заказчиков не бравших в прокат вещи ценой мене 5000руб. в прокатных пунктах чужих районов;
	•	найти заказчиков, бравших вещи во всех прокатных пунктах с размером комиссионных менее 5%.
  
  
5. Реализовать запросы с использованием аггрегатных функций:
	•	найти средний срок проката вещей, бравшихся в прокатных пунктах Советского района;
	•	найти заказчика, имеющего минимальную скидку среди бравших вещи в бюро проката N8;
	•	найти те записи о прокате, где стоимость проката больше средней по району, в котором располагается бюро найма;
	•	найти общее число вещей, бравшихся Семеновым.

6. Используя средства группировки реализовать следующие запросы:
	•	найти суммарную величину стоимости проката для каждой вещи;
	•	определить для каждой вещи средний срок проката за осенний период;
	•	найти для каждого заказчика, бравшего вещи во всех бюро проката Советского района, число различных бравшихся в прокат вещей;
	•	получить сводную таблицу “бюро проката - вещь-суммарная стоимость проката”.

